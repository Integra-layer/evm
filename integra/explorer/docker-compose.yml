version: '3.8'

# Blockscout Explorer for Integra Chain
# Run: docker-compose up -d

services:
  db:
    image: postgres:15
    restart: always
    environment:
      POSTGRES_PASSWORD: blockscout
      POSTGRES_USER: blockscout
      POSTGRES_DB: blockscout
    volumes:
      - postgres-data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U blockscout"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    restart: always
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data

  backend:
    image: blockscout/blockscout:latest
    restart: always
    depends_on:
      - db
      - redis
    environment:
      # Database
      DATABASE_URL: postgresql://blockscout:blockscout@db:5432/blockscout
      
      # Integra Chain RPC - UPDATE THESE FOR YOUR DEPLOYMENT
      ETHEREUM_JSONRPC_VARIANT: geth
      ETHEREUM_JSONRPC_HTTP_URL: http://host.docker.internal:8545
      ETHEREUM_JSONRPC_WS_URL: ws://host.docker.internal:8546
      ETHEREUM_JSONRPC_TRACE_URL: http://host.docker.internal:8545
      
      # Chain Info
      CHAIN_ID: "1343"
      NETWORK: Integra
      SUBNETWORK: Integra Mainnet
      COIN: INTG
      COIN_NAME: Integra
      
      # Features
      DISABLE_EXCHANGE_RATES: "true"
      SHOW_TXS_CHART: "true"
      ENABLE_TXS_STATS: "true"
      BLOCK_TRANSFORMER: base
      
      # API
      API_V2_ENABLED: "true"
      
      # Redis
      ACCOUNT_REDIS_URL: redis://redis:6379/1
      
      # Misc
      ECTO_USE_SSL: "false"
      SECRET_KEY_BASE: "RMgI4C1HSkxsEjdhtGMfwAHfyT6CKWXOgzCboJflfSm4jeAlic52io05KB6mqzc5"
      
    ports:
      - "4000:4000"
    command: sh -c "bin/blockscout eval 'Elixir.Explorer.ReleaseTasks.create_and_migrate()' && bin/blockscout start"

  frontend:
    image: ghcr.io/blockscout/frontend:latest
    restart: always
    depends_on:
      - backend
    environment:
      NEXT_PUBLIC_API_HOST: localhost
      NEXT_PUBLIC_API_PORT: "4000"
      NEXT_PUBLIC_API_PROTOCOL: http
      NEXT_PUBLIC_NETWORK_NAME: Integra
      NEXT_PUBLIC_NETWORK_SHORT_NAME: INTG
      NEXT_PUBLIC_NETWORK_ID: "1343"
      NEXT_PUBLIC_NETWORK_CURRENCY_NAME: Integra
      NEXT_PUBLIC_NETWORK_CURRENCY_SYMBOL: INTG
      NEXT_PUBLIC_NETWORK_CURRENCY_DECIMALS: "18"
      NEXT_PUBLIC_HOMEPAGE_CHARTS: "['daily_txs']"
      NEXT_PUBLIC_IS_TESTNET: "false"
    ports:
      - "3000:3000"

volumes:
  postgres-data:
  redis-data:

